---
title: "Ukol 1"
output: html_document
date: "2025-20-01"
---

# Pravděpodobnostní rozdělení výběrového průměru

## 1.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
library(readxl)
library(ggplot2)
library(dplyr)
library(tidyr)
``` 

## Načtení dat a příprava populace


```{r}
#xlsx_path <- "D:/pavli/Dokumenty/git/vyberove-setreni/ukol1/Vysky.xlsx"
xlsx_path <- "C:/Users/pavli/Documents/git/vyberove-setreni/ukol1/Vysky.xlsx"

df <- read_excel(xlsx_path, col_names = FALSE)

df <- df[-c(1:2),]

vysky <- as.numeric(df[[2]])
 
pop <- c(vysky, 172)

N <- length(pop)
pop_mean <- mean(pop)
pop_var_pop <- var(pop) * (N-1) / N
```

## 1) Pravděpodobnostní rozdělení výběrového průměru (n = 3,4,5)

```{r sampling-means-functions}
# Funkce: všechny kombinace bez vraceni a vypocet vyberovych prumeru
sample_means_all <- function(population, n) {
  comb_means <- combn(population, n, FUN = mean)
  return(as.numeric(comb_means))
}

# Funkce pro vypocet pravdepodobnostni (pmf) a distribuční (ecdf) funkce
pmf_from_values <- function(values) {
  tbl <- table(values)
  probs <- as.numeric(tbl)/sum(tbl)
  names(probs) <- names(tbl)
  return(probs)
}

ecdf_values <- function(values) {
  return(ecdf(values))
}

# Pro ulozeni vysledku pro ruzna n
ns <- c(3,4,5)
means_list <- lapply(ns, function(n) sample_means_all(pop, n))
names(means_list) <- paste0("n", ns)

# PMF a ECDF priprava
pmf_list <- lapply(means_list, pmf_from_values)
ecdf_list <- lapply(means_list, ecdf_values)

# Stredni hodnota, rozptyl, bias pro kazde n
stats_means <- lapply(means_list, function(v) {
  m <- mean(v)
  vvar <- var(v) * (length(v)-1)/length(v)
  bias <- m - pop_mean
  list(mean = m, var = vvar, bias = bias)
})

names(stats_means) <- paste0("n", ns)
```

### i) Pravděpodobnostní a distribuční funkce (ukázka pro n=3)

```{r pmf-plot-n3, fig.width=6, fig.height=4}
# PMF jako svisle cary (type = "h") a hustota (histogram) pro n=3
n <- 3
vals <- means_list[[which(ns==n)]]
df_vals <- data.frame(mean = vals)

# ECDF using stat_ecdf
p_ecdf <- ggplot(df_vals, aes(x = mean)) +
  stat_ecdf(geom = "step", pad = FALSE, size = 1) +
  labs(title = paste0("ECDF výběrového průměru (n=", n, ")"), x = "Průměr (cm)", y = "F(x)") +
  theme_minimal()

# PMF: aggregate rounded means to compute discrete probabilities
df_pmf <- df_vals %>%
  mutate(mean_r = round(mean, 2)) %>%
  count(mean_r) %>%
  mutate(prob = n / sum(n))

p_pmf <- ggplot(df_pmf, aes(x = mean_r, y = prob)) +
  geom_segment(aes(x = mean_r, xend = mean_r, y = 0, yend = prob), size = 1.2) +
  geom_point(size = 2) +
  labs(title = paste0("PMF výběrového průměru (n=", n, ")"), x = "Průměr (cm)", y = "P") +
  theme_minimal()

print(p_ecdf)
print(p_pmf)
```

### ii) Střední hodnota a rozptyl výběrového průměru; bias

```{r mean-var-bias}
df_stats_means <- bind_rows(lapply(seq_along(stats_means), function(i) {
  s <- stats_means[[i]]
  data.frame(n = ns[i], mean = s$mean, variance = s$var, bias = s$bias)
}))
df_stats_means$n <- factor(df_stats_means$n)

knitr::kable(df_stats_means, digits = 4, caption = "Střední hodnota, rozptyl a bias výběrového průměru")

df_bias <- df_stats_means %>% select(n, bias)
knitr::kable(df_bias, digits = 4, caption = "Bias pro jednotlivá n")
```

### iii) Variabilita odhadů (CV, decily, kvartily, IQR)

```{r variability}
variability_summary <- lapply(means_list, function(v) {
  mu <- mean(v)
  sdv <- sd(v)
  cv <- sdv/mu 
  dec1 <- quantile(v, probs = 0.1, type = 4)
  dec9 <- quantile(v, probs = 0.9, type = 4)
  q1 <- quantile(v, probs = 0.25, type = 4)
  q3 <- quantile(v, probs = 0.75, type = 4)
  iqr <- q3 - q1
  data.frame(cv = cv, dec1 = dec1, dec9 = dec9, q1 = q1, q3 = q3, iqr = iqr)
})
df_variability <- bind_rows(variability_summary)
df_variability$n <- factor(ns)
df_variability <- df_variability %>% select(n, everything())

knitr::kable(df_variability, digits = 4, caption = "Variabilita odhadů (CV, decily, kvartily, IQR) pro jednotlivá n")
```

### iv) Grafické porovnání rozdělení pro různé n

```{r compare-means-plot, fig.width=8, fig.height=5}
# Spojime data do long form pro ggplot
df_means <- bind_rows(lapply(seq_along(means_list), function(i) {
  data.frame(n = ns[i], mean = means_list[[i]])
}), .id = NULL)
df_means$n <- factor(df_means$n)

ggplot(df_means, aes(x = mean, colour = n, fill = n)) +
  geom_density(alpha = 0.2) +
  labs(title = "Hustota výběrového průměru pro různé n", x = "Výběrový průměr (cm)", y = "Hustota") +
  theme_minimal()
```

## 2) Pravděpodobnostní rozdělení relativní četnosti a počtu studentů vyšších než já

```{r relative-frequency-setup}
# Vytvorime 0/1 vektor: 1 pokud student je vyssi nez 172
indicator <- ifelse(pop > 172, 1, 0)
M <- sum(indicator)  # pocet uspechu v populaci
pi_pop <- mean(indicator) # populační relativní četnost
N; M; pi_pop

# Funkce pro relativni cetnost: vsechny kombinace a vypocet podilu
sample_prop_all <- function(population_indicator, n) {
  # vybereme indexy kombinaci (rychle pres combn nad 0/1 vektorem)
  comb_props <- combn(population_indicator, n, FUN = function(x) mean(as.numeric(x)))
  as.numeric(comb_props)
}

# Ulozime pro n=3,4,5
props_list <- lapply(ns, function(n) sample_prop_all(indicator, n))
names(props_list) <- paste0("n", ns)

# PMF pro relativni cetnost lze spoctout pomoci hypergeometricke hustoty pro diskretni mozne hodnoty
hyper_pmf_for_n <- function(N, M, n) {
  k <- 0:min(n, M)
  probs <- dhyper(k, M, N - M, n)
  data.frame(k = k, prop = k / n, prob = probs)
}

hyper_pmf_list <- lapply(ns, function(n) hyper_pmf_for_n(N, M, n))
names(hyper_pmf_list) <- paste0("n", ns)

```

### i) Pravděpodobnostní a distribuční funkce relativní četnosti (příklad n=4)

```{r pmf-prop-n4, fig.width=6, fig.height=4}
n <- 4
dfp <- hyper_pmf_list[[which(ns==n)]] %>% arrange(prop) %>% mutate(cumprob = cumsum(prob))

# PMF plot
p_prop_pmf <- ggplot(dfp, aes(x = prop, y = prob)) +
  geom_segment(aes(x = prop, xend = prop, y = 0, yend = prob), size = 1.2) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = dfp$prop) +
  labs(title = paste0("PMF relativní četnosti (n=", n, ")"), x = "Relativní četnost p", y = "P(p)") +
  theme_minimal()

# ECDF (from discrete support)
p_prop_ecdf <- ggplot(dfp, aes(x = prop, y = cumprob)) +
  geom_step(direction = "hv", size = 1) +
  geom_point(aes(y = cumprob), size = 2) +
  scale_x_continuous(breaks = dfp$prop) +
  labs(title = paste0("ECDF relativní četnosti (n=", n, ")"), x = "Relativní četnost p", y = "F(p)") +
  theme_minimal()

print(p_prop_pmf)
print(p_prop_ecdf)

```

### ii) Střední hodnota, rozptyl a bias pro relativní četnost

```{r stats-prop}
## Compute tidy summary for relative frequency estimates and show table
stats_props <- lapply(props_list, function(v) {
  m <- mean(v)
  vvar <- var(v) * (length(v)-1)/length(v)
  bias <- m - pi_pop
  data.frame(mean = m, variance = vvar, bias = bias)
})
df_stats_props <- bind_rows(stats_props)
df_stats_props$n <- factor(ns)
df_stats_props <- df_stats_props %>% select(n, everything())

knitr::kable(df_stats_props, digits = 4, caption = "Střední hodnota, rozptyl a bias odhadu relativní četnosti")

# Komentář: bias blízko 0 => odhad je nestranný
```

### iii) Grafické porovnání rozdělení relativní četnosti

```{r compare-prop-plot, fig.width=8, fig.height=5}
df_props <- bind_rows(lapply(seq_along(props_list), function(i) {
  data.frame(n = ns[i], prop = props_list[[i]])
}))
df_props$n <- factor(df_props$n)

ggplot(df_props, aes(x = prop, colour = n, fill = n)) +
  geom_density(alpha = 0.2) +
  labs(title = "Hustota odhadu relativní četnosti pro různé n", x = "Relativní četnost", y = "Hustota") +
  theme_minimal()
```

### iv) Pravděpodobnostní rozdělení počtu studentů vyšších než já (hypergeometrické rozdělení)

```{r count-distribution}
# Pocet vysledku k ma rozdeleni hypergeom: P(K=k) = dhyper(k, M, N-M, n)
counts_list <- lapply(ns, function(n) {
  k <- 0:min(n, M)
  data.frame(k = k, prob = dhyper(k, M, N - M, n), n = n)
})
counts_df <- bind_rows(counts_list)
knitr::kable(counts_df, digits = 4, caption = "Rozdělení počtu studentů vyšších než já (hypergeometrické)")

# Rozdeleni: hypergeometricke (protoze bez vraceni z konecne populace)
```


